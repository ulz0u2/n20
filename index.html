<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>discordで書かれたフレコをコピー</title>
</head>
<body style="text-align: center; font-family: 'Yu Gothic', 'メイリオ', sans-serif;">

    <div id="copyStatus" style="font-size: 35px; margin-top: 120px; font-weight: bold;">コピー: 読み込み中</div>
    <button onclick="copyToClipboard()" id="copyButton" style="background-color: #0D6EFD; color: white; font-size: 30px; margin-top: 30px; border-radius: 9px;" disabled>コピーする</button>

    <script>
        window.onload = displayInitialStatus;
        window.onhashchange = displayInitialStatus;

        let loadingDots = 0;
        let loadingInterval;

        function displayInitialStatus() {
            const rawHash = location.hash.slice(1); // #を除去
            const sanitizedHash = rawHash.replace(/-/g, '').replace('SW-', ''); // ハイフンを除去し、SW-も削除
            const copyButton = document.getElementById('copyButton');
            const copyStatus = document.getElementById('copyStatus');

            // 正しい12桁のフレコが存在する場合のみ表示を更新
            if (sanitizedHash.length === 12 && /^\d{12}$/.test(sanitizedHash)) {
                copyStatus.innerText = 'フレコ: ' + rawHash; // ハイフンありで表示
                copyButton.dataset.clipboardText = sanitizedHash; // ハイフンなしで保存
                copyButton.innerText = 'コピーする';
                copyButton.disabled = false;
                
                // ローディングアニメーションを開始
                startLoadingAnimation(copyStatus);
            } else {
                // フレコが無い、または不正な場合は読み込み中に戻す
                copyStatus.innerText = 'フレコ: 読み込み中';
                copyButton.innerText = 'コピーする';
                copyButton.disabled = true;
                stopLoadingAnimation(); // 不正な場合はアニメーションを停止
            }
        }

        function startLoadingAnimation(copyStatus) {
            // ローディングアニメーションの開始
            loadingInterval = setInterval(function() {
                copyStatus.innerText = 'フレコ: 読み込み中' + '.'.repeat(loadingDots);
                loadingDots = (loadingDots + 1) % 4; // 3点まで増えて、また0に戻す
            }, 500);
        }

        function stopLoadingAnimation() {
            // アニメーションを停止
            clearInterval(loadingInterval);
        }

        function copyToClipboard() {
            const copyButton = document.getElementById('copyButton');
            const textToCopy = copyButton.dataset.clipboardText;

            if (!textToCopy) return;

            const textarea = document.createElement('textarea');
            textarea.value = textToCopy;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            stopLoadingAnimation(); // コピー後にローディングを停止

            copyButton.innerText = 'コピーしました！';
            copyButton.disabled = true;
        }
    </script>

</body>
</html>
